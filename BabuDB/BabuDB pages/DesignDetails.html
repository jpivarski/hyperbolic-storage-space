<!DOCTYPE html>
<html style="cursor: auto ! important;"><head>
 <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
 <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
 
 <meta name="ROBOTS" content="NOARCHIVE">
 
 <link rel="icon" type="image/vnd.microsoft.icon" href="http://www.gstatic.com/codesite/ph/images/phosting.ico">
 
 
 <link rel="canonical" href="http://code.google.com/p/babudb/wiki/DesignDetails">
 
 <script async="" src="DesignDetails_files/cbgapi.js"></script><script gapi_processed="true" src="DesignDetails_files/plusone.js" async="" type="text/javascript"></script><script type="text/javascript">
 
 
 
 
 var codesite_token = "BlG-L0lHc58Z9c5vFhszMz-Q3zA:1346573163716";
 
 
 var CS_env = {"profileUrl":["/u/115036434905974694138/"],"token":"BlG-L0lHc58Z9c5vFhszMz-Q3zA:1346573163716","assetHostPath":"http://www.gstatic.com/codesite/ph","domainName":null,"assetVersionPath":"http://www.gstatic.com/codesite/ph/5121560014714628542","projectHomeUrl":"/p/babudb","relativeBaseUrl":"","projectName":"babudb","loggedInUserEmail":"jpivarski@gmail.com"};
 var _gaq = _gaq || [];
 _gaq.push(
 ['siteTracker._setAccount', 'UA-18071-1'],
 ['siteTracker._trackPageview']);
 
 _gaq.push(
 ['projectTracker._setAccount', 'UA-4530467-2'],
 ['projectTracker._trackPageview']);
 
 (function() {
 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
 (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ga);
 })();
 
 </script><script src="DesignDetails_files/ga.js" async="" type="text/javascript"></script>
 
 
 <title>DesignDetails - 
 babudb -
 
 babudb design details - 
 An embedded non-relational database for Java and C++ - Google Project Hosting
 </title>
 <link type="text/css" rel="stylesheet" href="DesignDetails_files/core.css">
 
 <link type="text/css" rel="stylesheet" href="DesignDetails_files/ph_detail.css">
 
 
 
 <link type="application/atom+xml" rel="alternate" href="http://code.google.com/feeds/p/babudb/svnchanges/basic?path=/wiki/DesignDetails.wiki">
 
 
<!--[if IE]>
 <link type="text/css" rel="stylesheet" href="http://www.gstatic.com/codesite/ph/5121560014714628542/css/d_ie.css" >
<![endif]-->
 <style type="text/css">
 .menuIcon.off { background: no-repeat url(http://www.gstatic.com/codesite/ph/images/dropdown_sprite.gif) 0 -42px }
 .menuIcon.on { background: no-repeat url(http://www.gstatic.com/codesite/ph/images/dropdown_sprite.gif) 0 -28px }
 .menuIcon.down { background: no-repeat url(http://www.gstatic.com/codesite/ph/images/dropdown_sprite.gif) 0 0; }
 
 
 #maincol {
 padding-top: 0;
 padding-bottom: 0;
 }

 
 </style>
</head>
<body class="t6">
<script type="text/javascript">
 window.___gcfg = {lang: 'en'};
 (function() 
 {var po = document.createElement("script");
 po.type = "text/javascript"; po.async = true;po.src = "https://apis.google.com/js/plusone.js";
 var s = document.getElementsByTagName("script")[0];
 s.parentNode.insertBefore(po, s);
 })();
</script>
<div class="headbg">

 <div id="gaia">
 

 <span>
 
 
 
 <a href="#" id="multilogin-dropdown" onclick="return false;"><u><b>jpivarski@gmail.com</b></u> <small>▼</small></a>
 
 
 | <a href="http://code.google.com/u/115036434905974694138/" id="projects-dropdown" onclick="return false;"><u>My favorites</u> <small>▼</small></a>
 | <a href="http://code.google.com/u/115036434905974694138/" onclick="_CS_click('/gb/ph/profile');" title="Profile, Updates, and Settings"><u>Profile</u></a>
 | <a href="https://www.google.com/accounts/Logout?continue=http%3A%2F%2Fcode.google.com%2Fp%2Fbabudb%2Fwiki%2FDesignDetails" onclick="_CS_click('/gb/ph/signout');"><u>Sign out</u></a>
 
 </span>

 </div>

 <div class="gbh" style="left: 0pt;"></div>
 <div class="gbh" style="right: 0pt;"></div>
 
 
 <div style="height: 1px"></div>
<!--[if lte IE 7]>
<div style="text-align:center;">
Your version of Internet Explorer is not supported. Try a browser that
contributes to open source, such as <a href="http://www.firefox.com">Firefox</a>,
<a href="http://www.google.com/chrome">Google Chrome</a>, or
<a href="http://code.google.com/chrome/chromeframe/">Google Chrome Frame</a>.
</div>
<![endif]-->



 <table style="padding:0px; margin: 0px 0px 10px 0px; width:100%" itemscope="" itemtype="http://schema.org/CreativeWork" cellpadding="0" cellspacing="0">
 <tbody><tr style="height: 58px;">
 
 <td id="plogo">
 <link itemprop="url" href="http://code.google.com/p/babudb">
 <a href="http://code.google.com/p/babudb/">
 
 
 <img src="DesignDetails_files/logo.png" alt="Logo" itemprop="image">
 
 </a>
 </td>
 
 <td style="padding-left: 0.5em">
 
 <div id="pname">
 <a href="http://code.google.com/p/babudb/"><span itemprop="name">babudb</span></a>
 </div>
 
 <div id="psum">
 <a id="project_summary_link" href="http://code.google.com/p/babudb/"><span itemprop="description">An embedded non-relational database for Java and C++</span></a>
 
 </div>
 
 
 </td>
 <td style="white-space:nowrap;text-align:right; vertical-align:bottom;">
 
 <form action="/hosting/search">
 <input size="30" name="q" type="text">
 
 <input name="projectsearch" value="Search projects" type="submit">
 </form>
 
 </td></tr>
 </tbody></table>

</div>

 
<div id="mt" class="gtb"> 
 <a href="http://code.google.com/p/babudb/" class="tab ">Project&nbsp;Home</a>
 
 
 
 
 <a href="http://code.google.com/p/babudb/downloads/list" class="tab ">Downloads</a>
 
 
 
 
 
 <a href="http://code.google.com/p/babudb/w/list" class="tab active">Wiki</a>
 
 
 
 
 
 <a href="http://code.google.com/p/babudb/issues/list" class="tab ">Issues</a>
 
 
 
 
 
 <a href="http://code.google.com/p/babudb/source/checkout" class="tab ">Source</a>
 
 
 
 
 
 
 
 <div class="gtbc"></div>
</div>
<table class="st" align="center" border="0" cellpadding="0" cellspacing="0" width="100%">
 <tbody><tr>
 
 
 
 
 <td class="subt">
 <div class="issueDetail">
<div class="isf">
 
 <span class="inIssueList"> 
 <span>Search</span>
 <form action="/p/babudb/w/list" method="GET" style="display:inline">
 <select id="can" name="can">
 <option disabled="disabled">Search within:</option>
 
 <option value="1">&nbsp;All wiki pages</option>
 <option value="3">&nbsp;Featured pages</option>
 <option value="2" selected="selected">&nbsp;Current pages</option>
 
 
 <option value="5">&nbsp;My starred pages</option>
 
 <option value="4">&nbsp;Deprecated pages</option>
 
 </select>
 <span>for</span>
 <span id="qq"><input size="38" id="searchq" name="q" autocomplete="off" type="text"></span>
 
 
 
 <input value="Search" type="submit">
 </form>
 </span>

 
 
 
 
 
 
 

</div>
</div>

 </td>
 
 
 
 
 
 
 <td class="bevel-right" align="right" valign="top"></td>
 </tr>
</tbody></table>


<script type="text/javascript">
 var cancelBubble = false;
 function _go(url) { document.location = url; }
</script>
<div id="maincol">

 
<!-- IE -->







 <style type="text/css">
 .delcom { background: #e8e8e8 }
 .commentcontent {
 margin: 2em;
 padding: 0px 10px;
 width: 66em;
 }
 .artifactcomment {
 border-top: 3px solid #c3d9ff;
 }
 #commentform {
 border-top: 3px solid #c3d9ff;
 }
 </style>

<div id="wikipage">
<table>
 <tbody><tr>
 
 
 <td style="vertical-align:top; padding-left:5px">
 
 <div id="wikiheader">
 
 <img id="star_img" src="DesignDetails_files/star_off.gif" style="cursor:pointer" onclick="_CS_toggleStar(this,
 {'scope': 'wiki',
 'user': '_CURRENT_USER',
 'item': 'babudb:DesignDetails'
 });" height="15" width="15">
 
 <span style="font-size:120%;font-weight:bold">DesignDetails</span>
 &nbsp;
 <div> 
 
 <i>babudb design details</i>
 
 
 
 <div id="wikiauthor" style="float:right">
 Updated <span title="Thu Feb  4 21:04:47 2010">
 Feb 4, 2010</span>
 
 by 

 <a class="userlink" href="http://code.google.com/u/112450644897785433224/">fhupf...@gmail.com</a>
 
 </div>
 </div>
 </div>
 
 <div id="wikicontent">
 <div class="vt" id="wikimaincol">
 <h1><a name="Overview"></a>Overview<a href="#Overview" class="section_anchor"></a></h1><p><strong>babudb</strong> is an embedded database library providing management of persistent <strong>key-value</strong> indices.  </p><p><strong>babudb</strong> is inherently designed to support <strong>replication</strong>
 by providing full access to the operation log. The Java version comes 
with all the necessary components to set up a replicated database 
system; the C++ version is a plain embedded database with full access to
 the operation log. </p><p><strong>babudb</strong>'s architecture is based on <strong>LSM (overlay) trees</strong>.
 Instead of transactional operations on persistent B-trees, babudb 
maintains a large, immutable on-disk index and applies modifications to 
this index to a set of volatile overlay tress in memory. These 
modifications are made persistent by appending them to an operation log.
 All lookups check the overlay trees first and fall back to the on-disk 
index when no modifications have been made. The overlay trees are 
periodically merged with the on-disk index in the background. </p><p><strong>babudb</strong> has been designed to implement replicated databases for systems in which each node embeds a local <strong>babudb</strong> replica and accesses it exclusively.  </p><p>What <strong>babudb</strong> does not provide: </p><ul><li>client-server access </li><li>a data model beyond key-value pairs </li><li>a query engine </li><li>ACID transactions </li></ul><p></p><h1><a name="Organisation_of_a_Database"></a>Organisation of a Database<a href="#Organisation_of_a_Database" class="section_anchor"></a></h1><h1><a name="Blocked_and_Non-blocking_access"></a>Blocked and Non-blocking access<a href="#Blocked_and_Non-blocking_access" class="section_anchor"></a></h1><h2><a name="Stages"></a>Stages<a href="#Stages" class="section_anchor"></a></h2><h1><a name="Log_Format"></a>Log Format<a href="#Log_Format" class="section_anchor"></a></h1><h1><a name="Indices"></a>Indices<a href="#Indices" class="section_anchor"></a></h1><p>A
 BabuDB index is composed of a set of in-memory trees and a sorted 
on-disk index. A user snapshot creates a new in-memory index which has 
higher priority than the existing indices. Each index is traversed in 
descending order of priority with the disk-index last for a lookup. This
 is to guarantee that the latest value for a key is returned.  </p><p>Checkpoints
 (materialized snapshots) are triggered periodically by an external 
thread and writes out a new on-disk index. This index is a combination 
of the old on-disk index and the in-memory indices. Note that a 
checkpoint is written out asynchronously to disk and can be re-scheduled
 depending on the disk usage.    </p><h2><a name="Disk_structure"></a>Disk structure<a href="#Disk_structure" class="section_anchor"></a></h2><p>The
 on-disk index is stored as an array of key/value-pairs sorted on the 
key. The array is divided into blocks and in order to find keys 
efficiently a sparse index with pointers to each block is constructed. 
Searching inside the block index is done using binary search. The block 
index is written out after the array of key/value-pairs, but a copy is 
always kept in memory. It is also read back into memory upon recovery. 
This reduces the disk seeks per key lookup to at most one. The entire 
on-disk index is mmap:ed to let the OS take care of the disk block 
buffer management.  </p><p>The blocks are laid out to improve cache locality (see <a href="http://www-db.in.tum.de/teaching/ws0506/MMDBMS/download/pax_VLDB2001.pdf" rel="nofollow">http://www-db.in.tum.de/teaching/ws0506/MMDBMS/download/pax_VLDB2001.pdf</a>
 for more details). It starts with a header containing a pointer offset 
to the values, the number of entries in the block and indication if the 
keys and/or values are variable or fixed length. After that, the keys 
are stored ending with a list of pointer offsets to each key if they are
 variable length. The block ends with the values and a list of pointer 
offsets to each value.   </p><h2><a name="Lookups"></a>Lookups<a href="#Lookups" class="section_anchor"></a></h2>
 </div>
 </div>
 </td></tr><tr>
</tr></tbody></table>
 </div>


 
 
 
 
 
 <div id="commentform">
 <form action="../w/detail.do" method="post">
 <table>
 <tbody><tr><td class="vt">
 <input name="pagename" value="DesignDetails" type="hidden">
 <input name="token" value="BlG-L0lHc58Z9c5vFhszMz-Q3zA:1346573163716" type="hidden">
 <div class="graytext" style="float: right;">
 Hint: You can use <a href="http://code.google.com/p/support/wiki/WikiSyntax">Wiki Syntax.</a>
 </div>
 <div>Enter a comment:</div>
 <textarea name="content" rows="6" cols="100"></textarea><br><br>
 <input name="submit" value="Submit" type="submit">
 </td>
 </tr></tbody></table>
 </form>
 </div>
 
 
 
 
 
 <form name="delcom" action="../w/delComment.do" method="POST">
 <input name="sequence_num" value="" type="hidden">
 <input name="create_time" value="" type="hidden">
 <input name="mode" value="" type="hidden">
 <input name="pagename" value="DesignDetails" type="hidden">
 <input name="token" value="BlG-L0lHc58Z9c5vFhszMz-Q3zA:1346573163716" type="hidden">
 </form>


 <script src="DesignDetails_files/prettify.js"></script>
 <script type="text/javascript">
 prettyPrint();
 </script>

<script type="text/javascript" src="DesignDetails_files/dit_scripts.js"></script>



  
 
 
 <script type="text/javascript" src="DesignDetails_files/ph_core.js"></script>
 
 <script type="text/javascript" src="DesignDetails_files/ph_dwiki.js"></script>
 
 
 
 
</div> 

<div id="footer" dir="ltr">
 <div class="text">
 <a href="http://code.google.com/projecthosting/terms.html">Terms</a> -
 <a href="http://www.google.com/privacy.html">Privacy</a> -
 <a href="http://code.google.com/p/support/">Project Hosting Help</a>
 </div>
</div>
 <div class="hostedBy" style="margin-top: -20px;">
 <span style="vertical-align: top;">Powered by <a href="http://code.google.com/projecthosting/">Google Project Hosting</a></span>
 </div>

 
 


 
 



<div style="position: absolute; top: 18px; left: 908px; display: none;" id="menuDiv-projects-dropdown" class="menuDiv instance0"><div style="display: none;" class="menuCategory default"></div><b style="display: block;" class="categoryTitle projects">Projects</b><div class="menuCategory projects first"><a href="http://code.google.com/p/cassius/" style="display: block;" class="menuItem">cassius</a><a href="http://code.google.com/p/plothon/" style="display: block;" class="menuItem">plothon</a><a href="http://code.google.com/p/pyminuit/" style="display: block;" class="menuItem">pyminuit</a><a href="http://code.google.com/p/pyminuit2/" style="display: block;" class="menuItem">pyminuit2</a><a href="http://code.google.com/p/svgfig/" style="display: block;" class="menuItem">svgfig</a></div><div class="menuCategory controls"><hr class="menuSeparator"><a href="http://code.google.com/hosting/" style="display: block;" class="menuItem">Find open source projects...</a><a href="http://code.google.com/hosting/createProject" style="display: block;" class="menuItem">Create a project...</a></div></div><div style="position: absolute; top: 18px; left: 753px; display: none;" id="menuDiv-multilogin-dropdown" class="menuDiv instance1"><div class="menuCategory default first"><span style="display: block;" class="menuText"><b>jpivarski@gmail.com</b></span><a href="http://code.google.com/p/babudb/wiki/DesignDetails?authuser=1" style="display: block;" class="menuItem">jim.pivarski@opendatagroup.com</a></div><div class="menuCategory controls"><hr class="menuSeparator"><a href="http://www.google.com/accounts/AddSession?service=code&amp;continue=http%3A%2F%2Fcode.google.com%2Fp%2Fbabudb%2Fwiki%2FDesignDetails" style="display: block;" class="menuItem"><nobr>Sign in with another account...</nobr></a></div></div></body></html>